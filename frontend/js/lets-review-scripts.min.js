/* Copyright Cubell 2016 LR 1.2 */
(function(a){var x=!1,F=a(window),m=a("body"),y=a('[id^="cb-user-rating-"]'),G=a('[id^="cb-review-box-"]').find(".cb-overlay span"),z=Cookies.get("lets_review_user_rating");a("#cb-review-gallery-wrap");var g,f,A,h,u,k,d,B,v,C,n,b,e,p,D,c,q,w,r,t,E,l;a("body").hasClass("rtl")&&(x=!0);a.prototype.swipebox&&(a(".lets-review-lightbox").swipebox({useCSS:!0,useSVG:!1,initialIndexOnArray:0,hideCloseButtonOnMobile:!1,removeBarsOnMobile:!0,hideBarsDelay:0,videoMaxWidth:1140,beforeOpen:function(){},afterOpen:null,
afterClose:function(){},loopAtEnd:!1}),m.on("click touchend","#swipebox-slider .current img",function(){return!1}).on("click touchend","#swipebox-slider .current",function(){a("#swipebox-close").trigger("click")}));m=function(){a.each(G,function(){c=a(this);if(c.visible(!0))switch(D=c.closest('[id^="cb-review-box-"]'),E=D.data("cb-score-format"),c.removeClass("cb-trigger-zero"),E){case 1:c.addClass("cb-trigger");break;case 2:c.addClass("cb-trigger");break;default:c.addClass("cb-5-trigger")}})};m();
F.scroll(m);y.length&&y.each(function(){b=a(this);e=b.closest('[id^="cb-review-box-"]');n=e.data("cb-pid");q=e.data("cb-score-format");w=e.data("cb-reviewer");r=e.find(".cb-score-box");switch(q){case 1:p=b.find(".cb-bar");break;case 2:p=b.find(".cb-bar");break;default:p=b.find(".cb-overlay")}if(!(b.hasClass("cb-rated")||z instanceof Array&&-1<z.indexOf(n)))p.on("mousemove click mouseleave mouseenter",function(c){b=a(this).closest('[id^="cb-user-rating-"]');e=b.closest('[id^="cb-review-box-"]');n=
e.data("cb-pid");q=e.data("cb-score-format");"mouseenter"==c.type&&(g=b.find(".cb-criteria"),C=g.html(),f=b.find(".cb-criteria-score"),A=f.data("cb-score-cache"),v=f.data("cb-width-cache"),k=b.find(".cb-overlay"),B=k.offset(),h=k.find("> span"),g.html(g.data("cb-txt")));u=Math.ceil((c.pageX-B.left)/(k.width()/100));d=!0===x?100-u:u;100<d&&(d=100);1>d&&(d=0);switch(q){case 1:t=d;l=!1;break;case 2:t=Math.round(10*d)/100;l=!1;break;default:t=Math.round(d/20*10)/10,l=!0}e.hasClass("cb-out-of-5")?h.stop().animate({width:100-
d+"%"},15):h.stop().animate({width:d+"%"},15);f.html(t);if("mouseleave"==c.type||"click"==c.type)e.hasClass("cb-out-of-5")?h.stop().animate({width:100-v+"%"},200):h.stop().animate({width:v+"%"},200),f.html(A),g.html(C);if("click"==c.type)return a(this).off("mousemove click mouseleave mouseenter"),b.addClass("cb-rated cb-lr-tip-f"),a.ajax({type:"POST",data:{action:"lets_review_a_cb",letsReviewNonce:letsReview.letsReviewNonce,letsReviewScore:d,letsReviewPostID:n},url:letsReview.letsReviewAUrl,dataType:"json",
beforeSend:function(){b.addClass("cb-voting");3===w&&!1===l&&r.addClass("cb-fs-voting")},success:function(a){k.find("> span").css("width",a[0]+"%");b.find(".cb-votes-count").html(a[2]);f.html(a[1]);Cookies.set("lets_review_user_rating",a[3],{expires:7});b.removeClass("cb-voting");3===w&&!1===l&&(r.find(".cb-final-score").html(a[1]),r.removeClass("cb-fs-voting"));b.tipper({direction:"bottom",follow:!0})},error:function(a,b,c){console.log("cbur "+a+" :: "+b+" :: "+c)}}),!1})});a(".cb-lr-tip-f").tipper({direction:"bottom",
follow:!0})})(jQuery);